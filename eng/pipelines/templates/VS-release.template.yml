---
steps:
- checkout: self

- task: UseDotNet@2
  displayName: 'Use .NET Core sdk'
  inputs:
    packageType: sdk
    version: 5.x

- template: ../tasks/NuGetToolInstaller.yml

- template: ../tasks/MicroBuildSigningPlugin.yml

- template: ../tasks/MicroBuildLocalizationPlugin.yml

- template: ../steps/BuildSolution.yml
  parameters:
    Configuration: 'Lab.Release'

- template: ../steps/CollectAndPublishBinaries.yml
  parameters:
    TargetFolder: '$(Build.StagingDirectory)\drop'
    ArtifactName: 'drop'

- template: ../tasks/SignVerify.yml
  parameters:
    TargetFolders: '$(Build.StagingDirectory)\drop'

- template: ../steps/CopyAndPublishSymbols.yml

- script: |
    mkdir $(Build.StagingDirectory)\zips\
  displayName: "Create $(Build.StagingDirectory)/zips/ folder"

- template: ../steps/PublishOpenDebugAD7.yml
  parameters:
    Configuration: 'Lab.Release'
    RuntimeID: 'win-x64'
    SignedBinariesFolder: '$(Build.StagingDirectory)\drop'

- powershell: | 
    Copy-Item -Recurse '$(Build.StagingDirectory)\debugAdapters\win-x64\*' -Destination '$(Build.StagingDirectory)\drop\Release\vscode\.'
  displayName: "Copy OpenDebugAD7 to drop"

- template: ../steps/PackAndPublishVSPackages.yml
  parameters:
    BasePath: $(Build.StagingDirectory)

- template: ../tasks/MicroBuildCleanup.yml
...